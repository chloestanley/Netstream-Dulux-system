@model List<DULUXFINALPART1.Models.GuardsPage>

@{
    ViewData["Title"] = "Control Room Search";
}

<div class="container mt-4">
    <!-- Instructions Section -->
    <div class="alert alert-info mb-4">
        <h5 class="fw-bold">Instructions:</h5>
        <ul>
            <li>Use the search form to search for shipments by Date or Shipment Number.</li>
            <li>Enter the search query in the text field and click on the "🔍 Search" button to view results.</li>
            <li>If results are found, they will be displayed in a table with details such as Guard Name, Driver Name, Shipment Image, and Acceptance Status.</li>
            <li>The shipment image (if available) will be shown in a thumbnail format. You can hover over the image for a larger view.</li>
            <li>If no results are found, a "No results found" message will be displayed.</li>
        </ul>
    </div>

<div class="container mt-4">
    <div class="card shadow-lg p-4 border border-success">
        <h2 class="text-center text-success mb-4">🚢 Search Shipments</h2>

        <!-- Search Form -->
        <form asp-action="Search" method="post" class="d-flex justify-content-center gap-2">
            @Html.AntiForgeryToken() <!-- ✅ Security -->
            <input type="text" name="searchQuery" placeholder="Enter Date, Driver Name, Guard Name or Shipment Number" class="form-control w-50 border border-success" />
            <button type="submit" class="btn btn-success">🔍 Search</button>
        </form>
    </div>

    <div class="card shadow-lg mt-4 p-4 border border-success">
        <h3 class="text-center text-success">📜 Search Results</h3>
        <div class="table-responsive">
            <table class="table table-striped table-hover mt-3">
                <thead class="bg-success text-white text-center">
                    <tr>
                        <th>Shipment Number</th> <!-- 🆕 Shipment Column -->
                        <th>Guard Name</th>
                        <th>Guard Security Card No</th>
                        <th>Driver Name</th>
                        <th>Driver Security Card No</th>
                        <th>Images</th>
                            <th>Vehicle License</th>
                            <th>Trailer License</th>
                        <th>Signature</th>



                        
                        <th>Date</th>
                        <th>Confirmation</th>



                    </tr>
                </thead>
                <tbody class="text-center">
                    @foreach (var item in Model)
                    {
                            <tr>
                                <td>
                                    @if (item.ScanImage != null)
                                    {
                                        @item.ScanImage.Shipment
                                    }
                                    else
                                    {
                                        <span class="text-muted">N/A</span>
                                    }
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.Guard_Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Guard_SecurityCard_No)</td>
                                <td>@Html.DisplayFor(modelItem => item.Driver_Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Driver_SecurityCard_No)</td>
                                
                                <td>
                                    <div class="d-flex flex-wrap gap-2">
                                        @if (!string.IsNullOrEmpty(item.ImageUrl1))
                                        {
                                            <img src="@item.ImageUrl1" class="img-thumbnail" style="max-width: 100px; height: auto;" />
                                        }
                                        @if (!string.IsNullOrEmpty(item.ImageUrl2))
                                        {
                                            <img src="@item.ImageUrl2" class="img-thumbnail" style="max-width: 100px; height: auto;" />
                                        }
                                        @if (!string.IsNullOrEmpty(item.ImageUrl3))
                                        {
                                            <img src="@item.ImageUrl3" class="img-thumbnail" style="max-width: 100px; height: auto;" />
                                        }
                                        @if (!string.IsNullOrEmpty(item.ImageUrl4))
                                        {
                                            <img src="@item.ImageUrl4" class="img-thumbnail" style="max-width: 100px; height: auto;" />
                                        }
                                    </div>
                                </td>

                                <td>
                                    <strong>Plate:</strong> @item.VehiclePlateNumber <br />
                                    <strong>Type:</strong> @item.VehicleType <br />
                                    <strong>Make:</strong> @item.VehicleMake <br />
                                    <strong>Color:</strong> @item.VehicleColor <br />
                                    <strong>VIN:</strong> @item.VehicleVin <br />
                                    <strong>Expiry:</strong> @item.VehicleExpiryDate
                                </td>

                                <td>
                                    <strong>Plate:</strong> @item.TrailerPlateNumber <br />
                                    <strong>Type:</strong> @item.TrailerType <br />
                                    <strong>Make:</strong> @item.TrailerMake <br />
                                    <strong>Color:</strong> @item.TrailerColor <br />
                                    <strong>VIN:</strong> @item.TrailerVin <br />
                                    <strong>Expiry:</strong> @item.TrailerExpiryDate
                                </td>

                                

                                <td>
                                    @if (!string.IsNullOrEmpty(item.Signature))
                                    {
                                        <img src="@item.Signature" alt="Guard's Signature" class="img-thumbnail" width="150" />
                                    }
                                    else
                                    {
                                        <span class="text-muted">No signature available</span>
                                    }
                                </td>
                               

                                
                                <td>@Html.DisplayFor(modelItem => item.DateTime)</td>

                                        <td>
                                    @if (item.IsConfirmed)
                                    {
            <span class="text-success fw-bold">Confirmed</span>
                                    }
                                    else if (item.IsRejected)
                                    {
            <span class="text-danger fw-bold">Rejected</span>
                                    }
                                    else
                                    {
            <!-- Show buttons only if no decision has been made -->
            <form asp-action="Confirm" method="post" style="display:inline">
                <input type="hidden" name="id" value="@item.GuardsId" />
                <input type="hidden" name="confirm" value="true" />
                <button type="submit" class="btn btn-success btn-sm">Yes</button>
            </form>

            <form asp-action="Confirm" method="post" style="display:inline">
                <input type="hidden" name="id" value="@item.GuardsId" />
                <input type="hidden" name="confirm" value="false" />
                <button type="submit" class="btn btn-danger btn-sm">No</button>
            </form>
                                    }

                                    
    </td>



                            </tr>
                    }
                </tbody>
            </table>

            @if (Model == null || !Model.Any())
            {
                <div class="text-center text-muted mt-3">No results found.</div>
            }
        </div>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-warning text-center mt-4 border border-success shadow-sm">@TempData["Message"]</div>
    }
</div>

<script src="//code.tidio.co/daq8vctxa39sfedllqglgoc1fzfoapgx.js" async></script>